# 数据层存储设计
## 1. 内存数据库（主要存储）
Redis: 用于存储实时行情数据和最近的K线数据
高性能读写
支持丰富的数据结构（如Sorted Set用于时间序列）
可配置持久化选项

## 2. 时序数据库（历史数据存储）
TimescaleDB: 基于PostgreSQL的时序数据库扩展
专门优化时间序列数据存储和查询
支持标准SQL
自动分区和数据压缩
良好的可扩展性
## 3. 关系型数据库（配置和交易记录）
PostgreSQL: 存储交易记录、策略配置等结构化数据
强大的ACID特性
支持复杂查询
良好的扩展性

# 数据持久化策略
## 1. 实时数据处理
内存中维护最新数据用于快速计算
定期将数据同步到Redis进行缓存
实时行情数据保留最近N天（如30天）
## 2. 历史数据存储
使用TimescaleDB存储历史K线数据
按时间分区存储，提高查询性能
实现数据压缩和归档策略
## 3. 交易记录存储
使用PostgreSQL存储所有交易记录
实现交易日志和审计功能
支持复杂查询和报表生成
性能优化措施
并发访问控制：

使用读写锁（std::shared_mutex）保证数据访问安全
减少锁的粒度，提高并发性能
数据预计算：

在数据更新时预计算常用指标（如盈亏、涨跌幅等）
避免重复计算，提高响应速度
内存管理：

使用智能指针管理内存
实现数据过期机制，避免内存无限增长
事件驱动架构：

实现观察者模式，当数据更新时通知相关组件
减少轮询，提高系统响应速度